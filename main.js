(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}e.d({},{gm:()=>L,MJ:()=>P,Ui:()=>q,vB:()=>K,e_:()=>Z,_p:()=>Q,lw:()=>F,Tp:()=>k,Ny:()=>_,I1:()=>x,Lo:()=>B,Z1:()=>$,i0:()=>G,Hs:()=>Y,K3:()=>V,bY:()=>ee,Gf:()=>X,gL:()=>W});var r={baseUrl:"http://localhost:3001",headers:{"Content-Type":"application/json"}},n=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function o(e,t,r,n,o){var a=k.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__delete-button"),c=a.querySelector(".card__image"),u=a.querySelector(".card__title"),l=a.querySelector(".card__like-button"),s=a.querySelector(".card__like-button_counter");return c.src=e.link,c.alt=e.name,u.textContent=e.name,s.textContent=e.likes.length,e.likes.includes(t.id)&&l.classList.add("card__like-button_is-active"),t.id!==e.owner.id&&i.remove(),i.addEventListener("click",function(){return r(e,i)}),l.addEventListener("click",function(){return n(e,t,l,s)}),c.addEventListener("click",function(){o({link:e.link,name:e.name})}),a}function a(e,t){var o,a;(o={cardId:e.id},a=o.cardId,fetch("".concat(r.baseUrl,"/cards/").concat(a),{method:"DELETE",headers:r.headers}).then(n)).then(function(){t.parentElement.remove()}).catch(function(e){return console.log(e)})}function i(e,o,a,i){var c,u,l,s,p;e.likes.includes(o.id)?function(e){var t=e.cardId,o=e.userId,a=e.currentLikes;return fetch("".concat(r.baseUrl,"/cards/").concat(t),{method:"PATCH",headers:r.headers,body:JSON.stringify({likes:a.filter(function(e){return e!==o})})}).then(n)}({cardId:e.id,userId:o.id,currentLikes:e.likes}).then(function(t){e.likes=t.likes,i.textContent=e.likes.length,a.classList.remove("card__like-button_is-active")}):(c={cardId:e.id,userId:o.id,currentLikes:e.likes},u=c.cardId,l=c.userId,s=c.currentLikes,fetch("".concat(r.baseUrl,"/cards/").concat(u),{method:"PATCH",headers:r.headers,body:JSON.stringify({likes:[].concat((p=s,function(e){if(Array.isArray(e))return t(e)}(p)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(p)||function(e,r){if(e){if("string"==typeof e)return t(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(p)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),[l])})}).then(n)).then(function(t){e.likes=t.likes,i.textContent=e.likes.length,a.classList.add("card__like-button_is-active")})}function c(e){e.classList.add("popup_is-animated"),setTimeout(function(){e.classList.add("popup_is-opened")},0),e.addEventListener("click",l),document.addEventListener("keydown",s)}function u(e){e.classList.remove("popup_is-opened")}function l(e){e.currentTarget===e.target&&u(e.currentTarget)}function s(e){"Escape"===e.key&&document.querySelector(".popup_is-opened")&&u(document.querySelector(".popup_is-opened"))}function p(e){var t=e.link,r=e.name;F.src=t,Q.textContent=r,c(Z)}var d=function(e){var t=e.formElement,r=e.inputElement,n=e.inputErrorClass,o=e.errorClass,a=t.querySelector(".".concat(r.id,"-error"));r.classList.remove(n),a.classList.remove(o),a.textContent=""},m=function(e,t){var r=t.submitButtonSelector,n=t.inputSelector,o=t.inputErrorClass,a=t.errorClass,i=t.inactiveButtonClass;Array.from(e.querySelectorAll(n)).forEach(function(t){d({formElement:e,inputElement:t,inputErrorClass:o,errorClass:a}),console.log(t.validity),console.log(e.checkValidity())}),f({formElement:e,inactiveButtonClass:i,submitButtonSelector:r})},f=function(e){var t=e.formElement,r=e.inactiveButtonClass,n=e.submitButtonSelector,o=t.querySelector(n);t.checkValidity()?(o.removeAttribute("disabled"),o.classList.remove(r)):(o.setAttribute("disabled",!0),o.classList.add(r))};function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var _,v,S,h,b,E,C,g,k=document.querySelector("#card-template").content,q=document.querySelector(".content").querySelector(".places__list"),L=(document.querySelector(".popup"),document.querySelector(".popup_type_new-card")),A=document.querySelector(".profile__add-button"),w=L.querySelector(".popup__close"),B=document.querySelector(".popup_type_edit"),I=document.querySelector(".profile__edit-button"),T=B.querySelector(".popup__close"),O=document.querySelector(".popup_type_edit_avatar .popup__form"),x=document.querySelector(".popup_type_edit_avatar"),U=document.querySelector(".profile__image-edit"),j=x.querySelector(".popup__close"),P=x.querySelector(".popup__input_type_avatar"),M=document.querySelector(".profile__title"),N=document.querySelector(".profile__description"),D=document.querySelector(".profile__image"),J=document.querySelector(".popup__form").querySelector(".popup__button"),H=document.querySelector(".popup_type_edit .popup__form"),V=(H.querySelector(".popup__button"),H.querySelector(".popup__input_type_name")),G=H.querySelector(".popup__input_type_description"),$=document.querySelector(".popup_type_new-card .popup__form"),K=($.querySelector(".popup__button"),$.querySelector(".popup__input_type_card-name")),Y=$.querySelector(".popup__input_type_url"),Z=document.querySelector(".popup_type_image"),z=Z.querySelector(".popup__close"),F=Z.querySelector(".popup__image"),Q=Z.querySelector(".popup__caption"),R={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},W=function(e){var t=e.name,r=e.description;M.textContent=t,N.textContent=r},X=function(e){var t=e.image;D.style.backgroundImage="url(".concat(t,")")};function ee(e){J.textContent=e?"Сохранение...":"Сохранить"}A.addEventListener("click",function(){$.reset(),m($,R),c(L)}),w.addEventListener("click",function(){u(L)}),I.addEventListener("click",function(){V.value=M.textContent,G.value=N.textContent,m(H,R),c(B)}),T.addEventListener("click",function(){u(B)}),U.addEventListener("click",function(){O.reset(),m(O,R),c(x)}),j.addEventListener("click",function(){u(x)}),z.addEventListener("click",function(){u(Z)}),H.addEventListener("submit",function(e){var t,o,a;e.preventDefault(),ee(!0),(t={name:V.value,about:G.value},o=t.name,a=t.about,fetch("".concat(r.baseUrl,"/users/cf8a"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:o,about:a})}).then(n)).then(function(e){var t=e.name,r=e.about,n=e.avatar;W({name:t,description:r}),X({image:n}),u(B)}).catch(function(e){return console.log(e)}).finally(function(){ee(!1)})}),$.addEventListener("submit",function(e){var t,c,l,s;e.preventDefault(),ee(!0),(t={name:K.value,link:Y.value,owner:_},c=t.name,l=t.link,s=t.owner,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:c,link:l,likes:[],owner:s,createdAt:(new Date).toISOString()})}).then(n)).then(function(e){console.log(e.owner);var t=o(e,e.owner,a,i,p);q.prepend(t),u(L),$.reset()}).catch(function(e){return console.log(e)}).finally(function(){ee(!1)})}),O.addEventListener("submit",function(e){var t,o;e.preventDefault(),ee(!0),(t={avatar:P.value},o=t.avatar,fetch("".concat(r.baseUrl,"/users/cf8a/"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:o})}).then(n)).then(function(e){var t=e.avatar;X({image:t}),u(x)}).catch(function(e){console.log(e)}).finally(function(){ee(!1)})}),Promise.all([fetch("".concat(r.baseUrl,"/users"),{method:"GET"}).then(n).then(function(e){if(e.length>0)return e[0];throw new Error("Пользователь не найден")}),fetch("".concat(r.baseUrl,"/cards"),{method:"GET"}).then(n)]).then(function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(t,r)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=n[0],u=n[1];_=c,W({name:c.name,description:c.about}),X({image:c.avatar}),u.forEach(function(e){q.append(o(e,c,a,i,p))})}),S=(v=R).formSelector,h=v.inputSelector,b=v.submitButtonSelector,E=v.inactiveButtonClass,C=v.inputErrorClass,g=v.errorClass,Array.from(document.querySelectorAll(S)).forEach(function(e){e.addEventListener("submit",function(e){e.preventDefault()}),function(e){var t=e.formElement,r=e.inputSelector,n=e.submitButtonSelector,o=e.inactiveButtonClass,a=e.inputErrorClass,i=e.errorClass;t.querySelector(n),Array.from(t.querySelectorAll(r)).forEach(function(e){e.addEventListener("input",function(){!function(e){var t=e.formElement,r=e.inputElement,n=e.inputErrorClass,o=e.errorClass;r.validity.patternMismatch?r.setCustomValidity(r.dataset.errorMessage):r.setCustomValidity(""),r.validity.valid?d({formElement:t,inputElement:r,inputErrorClass:n,errorClass:o}):function(e){var t=e.inputElement,r=e.errorMessage,n=e.inputErrorClass,o=e.errorClass,a=e.formElement.querySelector(".".concat(t.id,"-error"));t.classList.add(n),a.textContent=r,a.classList.add(o)}({formElement:t,inputElement:r,errorMessage:r.validationMessage,inputErrorClass:n,errorClass:o})}({formElement:t,inputElement:e,inputErrorClass:a,errorClass:i}),f({formElement:t,inactiveButtonClass:o,submitButtonSelector:n})})}),f({formElement:t,inactiveButtonClass:o,submitButtonSelector:n})}({formElement:e,inputSelector:h,submitButtonSelector:b,inactiveButtonClass:E,inputErrorClass:C,errorClass:g})})})();